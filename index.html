<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbit Dodge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            touch-action: manipulation; /* Prevents double-tap to zoom on mobile */
        }
        canvas {
            display: block;
            background-color: #111827; /* bg-gray-900 */
            width: 100%;
            height: 100%;
        }
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks/taps to go through to the canvas */
        }
        .unselectable {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
        }
    </style>
</head>
<body class="bg-gray-900 text-white m-0 p-0">

    <div id="game-container" class="relative w-screen h-screen">
        <canvas id="gameCanvas"></canvas>

        <!-- Heads-Up Display (HUD) -->
        <div class="hud flex flex-col items-center justify-center p-8 unselectable">
            <!-- Score and High Score -->
            <div class="absolute top-8 text-center">
                <h2 class="text-xl md:text-2xl text-gray-400">SCORE: <span id="score">0</span></h2>
                <p class="text-sm md:text-base text-gray-500">HIGH SCORE: <span id="highScore">0</span></p>
            </div>

            <!-- Game Over / Start Screen -->
            <div id="ui-message" class="text-center pointer-events-auto">
                <h1 class="text-5xl md:text-7xl font-extrabold text-white">ORBIT DODGE</h1>
                <p class="text-lg md:text-xl text-gray-300 mt-4">Tap or Press Space to Start</p>
                <p class="text-sm text-gray-500 mt-2">(Change orbit to survive)</p>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('highScore');
        const uiMessageEl = document.getElementById('ui-message');

        // --- Game State & Configuration ---
        let player, center, projectiles, score, highScore, gameRunning, animationFrameId;
        let orbitalSpeed = 0.02;
        let direction = 1; // 1 for clockwise, -1 for counter-clockwise
        
        // --- Responsive Game Elements ---
        // These will be calculated in the init() function based on screen size
        let playerRadius, centerRadius, orbitRadius;

        // --- Utility Functions ---
        const distance = (p1, p2) => Math.hypot(p1.x - p2.x, p1.y - p2.y);

        // --- Game Initialization ---
        function init() {
            // Set canvas size to fill the screen
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // Make game elements responsive (with smaller scaling factors)
            const smallerDimension = Math.min(canvas.width, canvas.height);
            orbitRadius = smallerDimension * 0.18; // Was 0.25
            playerRadius = Math.max(6, smallerDimension * 0.02); // Was 0.03, min 8
            centerRadius = Math.max(12, smallerDimension * 0.04); // Was 0.05, min 15


            // Reset game state
            center = { x: canvas.width / 2, y: canvas.height / 2 };
            player = { angle: 0, x: 0, y: 0 }; // Angle will determine position on orbit
            projectiles = [];
            score = 0;
            highScore = localStorage.getItem('orbitDodgeHighScore') || 0;
            gameRunning = false;

            // Update UI
            scoreEl.textContent = score;
            highScoreEl.textContent = highScore;
            uiMessageEl.style.display = 'block';
            uiMessageEl.innerHTML = `
                <h1 class="text-5xl md:text-7xl font-extrabold text-white">ORBIT DODGE</h1>
                <p class="text-lg md:text-xl text-gray-300 mt-4">Tap or Press Space to Start</p>
                <p class="text-sm text-gray-500 mt-2">(Change orbit to survive)</p>
            `;

            // Initial render
            draw();
        }

        // --- Drawing Functions ---
        function draw() {
            // Clear canvas with a slight fade effect for trails
            ctx.fillStyle = 'rgba(17, 24, 39, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw center planet
            ctx.beginPath();
            ctx.arc(center.x, center.y, centerRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#4F46E5'; // Indigo-600
            ctx.shadowColor = '#4F46E5';
            ctx.shadowBlur = 15;
            ctx.fill();
            ctx.shadowBlur = 0;

            // Calculate player position
            player.x = center.x + Math.cos(player.angle) * orbitRadius;
            player.y = center.y + Math.sin(player.angle) * orbitRadius;

            // Draw player
            ctx.beginPath();
            ctx.arc(player.x, player.y, playerRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#A78BFA'; // Violet-400
            ctx.shadowColor = '#A78BFA';
            ctx.shadowBlur = 10;
            ctx.fill();
            ctx.shadowBlur = 0;

            // Draw projectiles
            projectiles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#F87171'; // Red-400
                ctx.fill();
            });
        }

        // --- Game Loop ---
        function animate() {
            if (!gameRunning) return;

            animationFrameId = requestAnimationFrame(animate);
            update();
            draw();
        }

        // --- Game Logic Update ---
        function update() {
            // Update player's orbital angle
            player.angle += orbitalSpeed * direction;

            // Update score
            score++;
            scoreEl.textContent = score;

            // Spawn projectiles
            // The spawn rate increases with the score
            if (Math.random() < 0.02 + score / 50000) {
                spawnProjectile();
            }

            // Update and check projectiles
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const p = projectiles[i];
                p.x += p.velocity.x;
                p.y += p.velocity.y;

                // Collision detection
                if (distance(player, p) < playerRadius + p.radius) {
                    endGame();
                    return;
                }

                // Remove projectiles that are off-screen
                if (p.x + p.radius < 0 || p.x - p.radius > canvas.width ||
                    p.y + p.radius < 0 || p.y - p.radius > canvas.height) {
                    projectiles.splice(i, 1);
                }
            }
        }

        // --- Projectile Spawning ---
        function spawnProjectile() {
            const smallerDimension = Math.min(canvas.width, canvas.height);
            // Scaled down projectile radius
            const radius = Math.random() * (smallerDimension * 0.015) + (smallerDimension * 0.008);
            let x, y;

            // Spawn from a random edge of the screen
            if (Math.random() < 0.5) {
                x = Math.random() < 0.5 ? 0 - radius : canvas.width + radius;
                y = Math.random() * canvas.height;
            } else {
                x = Math.random() * canvas.width;
                y = Math.random() < 0.5 ? 0 - radius : canvas.height + radius;
            }

            // Calculate angle to aim towards the center
            const angle = Math.atan2(center.y - y, center.x - x);
            // Scale speed with screen size and score
            const speed = (smallerDimension / 350) + score / 10000;
            const velocity = {
                x: Math.cos(angle) * speed,
                y: Math.sin(angle) * speed,
            };

            projectiles.push({ x, y, radius, velocity });
        }

        // --- Game State Control ---
        function startGame() {
            if (gameRunning) return;
            // Reset state without full re-initialization
            score = 0;
            projectiles = [];
            direction = 1;
            player.angle = 0;
            gameRunning = true;
            uiMessageEl.style.display = 'none';
            animate();
        }

        function endGame() {
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);

            // Update high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('orbitDodgeHighScore', highScore);
                highScoreEl.textContent = highScore;
            }

            // Show game over message
            uiMessageEl.innerHTML = `
                <h1 class="text-5xl md:text-7xl font-extrabold text-white">GAME OVER</h1>
                <p class="text-lg md:text-xl text-gray-300 mt-4">Your Score: ${score}</p>
                <p class="text-sm text-gray-500 mt-2">Tap or Press Space to Play Again</p>
            `;
            uiMessageEl.style.display = 'block';
        }

        // --- Event Listeners ---
        function handleUserAction() {
            if (gameRunning) {
                direction *= -1; // Reverse direction
            } else {
                startGame();
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                handleUserAction();
            }
        });

        // Use 'mousedown' for desktop and 'touchstart' for mobile
        window.addEventListener('mousedown', handleUserAction);
        window.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Prevent mouse event from firing
            handleUserAction();
        });

        window.addEventListener('resize', () => {
             // Stop the current game and re-initialize everything
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            init();
        });

        // --- Initial Call ---
        init();
    </script>
</body>
</html>
